webpackJsonp([3],{"37aX":function(e,t,o){"use strict";var a=o("x9MI");o.n(a).a},HIvp:function(e,t,o){(e.exports=o("FZ+f")(!1)).push([e.i,".source-list{margin-left:1rem}.source-list li:not(:first-child){margin-top:.75rem}.source-list .source-entry{display:flex}.source-list .source-entry .source-long{flex:1;max-width:15rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-right:1rem}.source-list .source-entry .source-extra-info{flex:2}",""])},LZch:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={components:{NewSource:{template:'\n    <div class="modal-card" style="width: auto">\n      <header class="modal-card-head" style="margin-bottom: 0;">\n        <p class="modal-card-title">Add new source</p>\n      </header>\n      <section class="modal-card-body">\n        <b-field label="Author"\n                 :type="{\'is-danger\': errors.has(\'source-author\')}"\n                 :message="errors.first(\'source-author\')">\n          <b-input v-model="formData.author"\n                   name="source-author"\n                   v-validate="\'required\'"\n                   data-vv-as="author">\n          </b-input>\n        </b-field>\n        <b-field label="Year"\n                 :type="{\'is-danger\': errors.has(\'source-year\')}"\n                 :message="errors.first(\'source-year\')">\n          <b-input v-model="formData.year"\n                   name="source-year"\n                   v-validate="\'required\'"\n                   data-vv-as="year">\n          </b-input>\n        </b-field>\n        <input type="hidden"\n               v-model="formData.long"\n               name="source-long"\n               v-validate="\'required\'"\n               data-vv-as="full citation"\n        />\n        <b-field label="Full citation"\n                 :type="{\'is-danger\': errors.has(\'source-long\')}"\n                 :message="errors.first(\'source-long\')">\n          <wysiwyg v-model="formData.long"></wysiwyg>\n        </b-field>\n        <b-field label="URL">\n          <b-input v-model="formData.url"></b-input>\n        </b-field>\n        <b-field label="Notes">\n          <wysiwyg v-model="formData.notes"></wysiwyg>\n        </b-field>\n        <footer class="modal-card-foot">\n          <a class="button is-primary has-text-grey-dark"\n             @click="onSubmit"\n             :disabled="errors.any()">\n             Submit\n          </a>\n          <a class="button is-danger" @click="$parent.close()">Cancel</a>\n        </footer>\n      </section>\n    </div>\n  ',data:function(){return{formData:{author:"",year:"",long:"",url:"",notes:""}}},$_veeValidate:{validator:"new"},methods:{onSubmit:function(){var e=this;this.$validator.validateAll(),this.errors.any()||axios.post("/sources",this.formData).then(function(t){e.$emit("change",t.data),e.$parent.close()}).catch(function(e){console.error(e)})}}},DescriptionModal:{props:["source"],data:function(){return{description:""}},template:'\n    <div class="modal-card" style="width: auto">\n      <header class="modal-card-head" style="margin-bottom: 0;">\n        <p class="modal-card-title">Description of {{ source.author }} ({{ source.year }})</p>\n      </header>\n      <section class="modal-card-body">\n        <wysiwyg v-model="description"></wysiwyg>\n        <footer class="modal-card-foot">\n          <a class="button is-primary has-text-grey-dark"\n             @click="onSubmit">\n             Save\n          </a>\n          <a class="button is-danger" @click="$parent.close()">Cancel</a>\n        </footer>\n      </section>\n    </div>\n  ',created:function(){this.description=this.source.pivot.description},methods:{onSubmit:function(){this.source.pivot.description=this.description,this.$parent.close()}}}},props:["value"],data:function(){return{sources:[],ajaxList:[],loading:!1,isNewSourceModalOpen:!1,isDescriptionModalOpen:!1,descriptionSource:{source:{}}}},methods:{onAutocompleteKeyUp:function(e){1==e.key.length&&this.loadSources(e.target.value)},loadSources:_.debounce(function(e){var t=this;this.loading=!0,axios.get("/autocomplete/sources",{params:{term:e}}).then(function(e){t.loading=!1,t.ajaxList=e.data}).catch(function(e){console.error(e)})},500),addSource:function(e){if(e){this.$set(e,"pivot",{extra_info:"",description:""});var t=this.value.clone();t.push(e),this.$emit("input",t)}},removeTags:function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])e=e.replace(/<[^>]+>/g,"");else{var t=e.match(/<([^\s>]+)[^>]*>(.*)<\/\1>/);t&&(e=t[2])}return e.replace("&nbsp;"," ")},removeSource:function(e){var t=this.value.clone();t.splice(e,1),this.$emit("input",t)},openDescriptionModal:function(e){this.descriptionSource.source=e,this.isDescriptionModalOpen=!0}}},n=(o("37aX"),o("K1/g")),s=Object(n.a)(a,function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("b-field",[o("b-autocomplete",{attrs:{data:e.ajaxList,field:"name",loading:e.loading,"clear-on-select":!0,expanded:"",placeholder:"Look up an existing source"},on:{select:e.addSource},nativeOn:{keyup:function(t){return e.onAutocompleteKeyUp(t)}}}),e._v(" "),o("p",{staticClass:"control"},[o("a",{staticClass:"button is-info",attrs:{title:"Add a new source"},on:{click:function(t){e.isNewSourceModalOpen=!0}}},[o("span",{staticClass:"icon"},[o("i",{staticClass:"fas fa-ellipsis-h"})])])])],1),e._v(" "),o("ol",{staticClass:"source-list",staticStyle:{"margin-left":"1rem"}},e._l(e.value,function(t,a){return o("li",[o("div",{staticClass:"source-entry"},[o("input",{attrs:{type:"hidden",name:"sources["+a+"][id]"},domProps:{value:t.id}}),e._v(" "),o("input",{attrs:{type:"hidden",name:"sources["+a+"][description]"},domProps:{value:t.pivot.description}}),e._v(" "),o("p",{staticClass:"source-long",attrs:{title:e.removeTags(t.long,!0)},domProps:{innerHTML:e._s(e.removeTags(t.long))}}),e._v(" "),o("b-input",{staticClass:"source-extra-info",attrs:{name:"sources["+a+"][extra_info]"},model:{value:t.pivot.extra_info,callback:function(o){e.$set(t.pivot,"extra_info",o)},expression:"source.pivot.extra_info"}}),e._v(" "),o("a",{staticClass:"button",class:{"is-info":t.pivot.description&&t.pivot.description.length>0},attrs:{title:"Add description"},on:{click:function(o){return e.openDescriptionModal(t)}}},[e._m(0,!0)]),e._v(" "),o("a",{staticClass:"button is-danger",attrs:{title:"Remove source"},on:{click:function(t){return e.removeSource(a)}}},[e._m(1,!0)])],1)])}),0),e._v(" "),o("b-modal",{attrs:{active:e.isDescriptionModalOpen,"has-modal-card":""},on:{"update:active":function(t){e.isDescriptionModalOpen=t}}},[o("description-modal",e._b({},"description-modal",e.descriptionSource,!1))],1),e._v(" "),o("b-modal",{attrs:{active:e.isNewSourceModalOpen,"has-modal-card":""},on:{"update:active":function(t){e.isNewSourceModalOpen=t}}},[o("new-source",{on:{change:e.addSource}})],1)],1)},[function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fas fa-align-justify"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fas fa-times"})])}],!1,null,null,null);t.default=s.exports},x9MI:function(e,t,o){var a=o("HIvp");"string"==typeof a&&(a=[[e.i,a,""]]);var n={transform:void 0};o("MTIv")(a,n);a.locals&&(e.exports=a.locals)}});